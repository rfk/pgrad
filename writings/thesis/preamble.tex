
\documentclass[a4paper,british,twoside,11pt]{book}

\usepackage[left=30mm,right=30mm,top=27mm,bottom=30mm,bindingoffset=10mm,includeheadfoot,headheight=14pt,a4paper]{geometry}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{verbatim}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{color}
\usepackage{tikz}
\usepackage{bibentry}
\usepackage[numbers]{natbib}
\usepackage{setspace}
\usepackage{fancyhdr}

% Colors for page number boxes
\definecolor{black}{rgb}{0,0,0}
\definecolor{lightgrey}{rgb}{0.80,0.80,0.80}

% Page headers and footers for fancy-style pages.
% Put Chapter/Section names in header.
% Put page numbers in footer in a little coloured box
\fancyhf{}
\fancyhead[RO]{\sffamily\bfseries \rightmark}
\fancyhead[LE]{\sffamily\bfseries \leftmark}
\fancyfoot[LE]{\setlength{\fboxsep}{2mm}
     \fcolorbox{black}{lightgrey}{\rule{0mm}{3mm}\bfseries \thepage}}
\fancyfoot[RO]{\setlength{\fboxsep}{2mm}
     \fcolorbox{black}{lightgrey}{\rule{0mm}{3mm}\bfseries \thepage}}
\renewcommand{\headrulewidth}{0.3mm}
\renewcommand{\footrulewidth}{0.3mm}
\renewcommand{\footruleskip}{0mm}
\pagestyle{fancy}                   

% Put matching footers on plain-style pages.
% No headers though.
\fancypagestyle{plain}{
\fancyhf{}
\fancyfoot[LE]{\setlength{\fboxsep}{2mm}
     \fcolorbox{black}{lightgrey}{\rule{0mm}{3mm}\bfseries \thepage}}
\fancyfoot[RO]{\setlength{\fboxsep}{2mm}
     \fcolorbox{black}{lightgrey}{\rule{0mm}{3mm}\bfseries \thepage}}
\renewcommand{\headrulewidth}{0mm}
\renewcommand{\footrulewidth}{0.3mm}
\renewcommand{\footruleskip}{0mm}
}

% Ensure blank pages are completely blank,
% rather than containing header rules.
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
        \hbox{}
        \vspace*{\fill}
        \thispagestyle{empty}
        \newpage
        \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother


% Proper naming for bibliography section
\renewcommand\bibname{References} 

% Redefine default figure placement to avoid putting on separate page
\makeatletter
\def\fps@figure{tbh}
\makeatother

% Useful Environment Definitions
\newenvironment{proofsketch}{\begin{proof}[Proof Sketch]}{\end{proof}}
\newtheorem{thm}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{example}{Example}
\newtheorem{defn}{Definition}
\newtheorem{defnL}[defn]{Definition}
\newtheoremstyle{thmext}{\topsep}{\topsep}{\itshape}{}{\bfseries}{.}{ }{\thmname{#1}\thmnote{ #3}}
\theoremstyle{thmext}
\newtheorem*{thmext}{Theorem}
\theoremstyle{plain}
\theoremstyle{thmext}
\newtheorem*{lemmaext}{Lemma}
\theoremstyle{plain}

% Pinched from LyX
\newcommand{\noun}[1]{\textsc{#1}}

% Enable fancy chapter headings
\usepackage[Lenny]{fncychap}

% Shortcut for formatting program snippets
\newcommand{\programinput}[1]{
  \begin{center}
  \framebox[0.8\textwidth]{
    \begin{minipage}[1\totalheight]{0.5\textwidth}{
      \verbatiminput{#1}
    }\end{minipage}
  }
  \end{center}
}

